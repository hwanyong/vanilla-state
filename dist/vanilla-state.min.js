!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VanillaState=e()}(this,(function(){"use strict";return class{constructor(t){return this._state={},this._listeners={},this._isPrimitive=!1,null!=t&&("object"!=typeof t||t instanceof Date)?(this._value=t,this._isPrimitive=!0):"object"==typeof t&&null!==t&&Object.keys(t).forEach((e=>{this._state[e]=t[e]})),new Proxy(this,{get:(t,e)=>"valueOf"===e?function(){return t._isPrimitive?t._value:t}:"toString"===e?function(){return t._isPrimitive?String(t._value):"[object VnlState]"}:e in t?t[e]:t._isPrimitive&&"value"===e?t._value:t._state[e],set:(t,e,i)=>{if(t._isPrimitive&&"value"===e){const e=t._value;return t._value=i,e!==i&&t.dispatchEvent("change",i),!0}if(t._isPrimitive&&""===e){const e=t._value;return t._value=i,e!==i&&t.dispatchEvent("change",i),!0}return e in t&&"function"!=typeof t[e]?t[e]=i:t._setState(e,i,!0),!0}})}addEventListener(t,e){this._listeners[t]||(this._listeners[t]=new Set),this._listeners[t].add(e)}removeEventListener(t,e){this._listeners[t]&&(this._listeners[t].delete(e),0===this._listeners[t].size&&delete this._listeners[t])}dispatchEvent(t,e,i){if(!this._listeners[t])return!0;const s=new CustomEvent(t,{bubbles:i?.bubbles||!1,cancelable:i?.cancelable||!1,composed:i?.composed||!1,detail:e});let n=!1;return this._listeners[t].forEach((i=>{try{i(e,s),s.cancelable&&s.defaultPrevented&&(n=!0)}catch(e){console.error(`Error in event listener for ${t}:`,e)}})),!n}_notify(t){const e=this._state[t];this.dispatchEvent(t,e),this._isPrimitive?this.dispatchEvent("change",this._value):this.dispatchEvent("change",{property:t,value:e})}_setState(t,e,i=!0){if(this._isPrimitive){const t=this._value;return this._value=e,void(i&&t!==e&&this.dispatchEvent("change",e))}const s=this._state[t];this._state[t]=e,i&&s!==e&&this._notify(t)}setWithoutNotify(t,e){this._setState(t,e,!1)}set(t){if(this._isPrimitive){const e=this._value;this._value=t,e!==t&&this.dispatchEvent("change",t)}else console.warn("set() method should only be called on primitive VnlState instances")}get(){return this._isPrimitive?this._value:{...this._state}}batch(t){if(this._isPrimitive)return void console.warn("batch() method cannot be used with primitive VnlState instances");const e={...this._state};t(new Proxy(this,{set:(t,e,i)=>(e in t&&"function"!=typeof t[e]?t[e]=i:t.setWithoutNotify(e,i),!0)}));const i=Object.keys(this._state).filter((t=>e[t]!==this._state[t]||!(t in e)));i.forEach((t=>{this._notify(t)})),i.length>0&&this.dispatchEvent("batch-completed",{changedProperties:i,oldState:e,newState:{...this._state}})}emit(t,e,i){return this.dispatchEvent(t,e,i)}toString(){return this._isPrimitive?String(this._value):"[object VnlState]"}valueOf(){return this._isPrimitive?this._value:NaN}}}));
